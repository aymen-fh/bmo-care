<%- include('../partials/layout-start', { title: __('specialists'), activePage: 'specialists' }) %>

    <div class="page-header">
        <h2><i class="fas fa-user-md"></i>
            <%= __('specialists') %>
        </h2>
        <div style="display: flex; gap: 10px;">
            <a href="/export/specialists?format=pdf" class="btn btn-outline" title="<%= __('export') %>">
                <i class="fas fa-file-pdf" style="color: #ef4444;"></i>
                <%= __('export') %>
            </a>
            <a href="/admin/specialists/create" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                <%= __('createSpecialist') %>
            </a>
        </div>
    </div>

    <style>
        .dropdown-content.show {
            display: block !important;
        }

        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }
    </style>

    <!-- Search Box -->
    <div class="search-container" style="margin-bottom: 20px;">
        <form action="/admin/specialists" method="GET" style="display: flex; gap: 10px;">
            <input type="text" name="search" placeholder="<%= __('staffIdSearchPlaceholder') %>"
                value="<%= searchQuery || '' %>"
                style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-search"></i>
                <%= __('search') %>
            </button>
            <% if (searchQuery) { %>
                <a href="/admin/specialists" class="btn btn-outline">
                    <i class="fas fa-times"></i>
                    <%= __('cancel') %>
                </a>
                <% } %>
        </form>
    </div>

    <!-- Advanced Filters -->
    <%- include('../partials/advanced-filters') %>

        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 40px;">
                            <input type="checkbox" id="selectAll" onclick="toggleSelectAll(this)">
                        </th>
                        <th>
                            <%= __('staffId') %>
                        </th>
                        <th>
                            <%= __('name') %>
                        </th>
                        <th>
                            <%= __('email') %>
                        </th>
                        <th>
                            <%= __('specialization') %>
                        </th>
                        <th>
                            <%= __('parents') %>
                        </th>
                        <th>
                            <%= __('children') %>
                        </th>
                        <th>
                            <%= __('actions') %>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <% if (specialists && specialists.length> 0) { %>
                        <% specialists.forEach(function(specialist) { %>
                            <tr>
                                <td>
                                    <input type="checkbox" class="select-item" value="<%= specialist._id %>"
                                        onchange="updateBulkActions()">
                                </td>
                                <td>
                                    <span class="badge badge-info">
                                        <%= specialist.staffId || 'N/A' %>
                                    </span>
                                </td>
                                <td>
                                    <div class="cell-with-icon">
                                        <div class="avatar-circle">
                                            <i class="fas fa-user-md"></i>
                                        </div>
                                        <span>
                                            <%= specialist.name %>
                                        </span>
                                    </div>
                                </td>
                                <td>
                                    <%= specialist.email %>
                                </td>
                                <td>
                                    <%= specialist.specialization || '-' %>
                                </td>
                                <td><span class="badge badge-info">
                                        <%= specialist.linkedParents ? specialist.linkedParents.length : 0 %>
                                    </span></td>
                                <td><span class="badge badge-warning">
                                        <%= specialist.assignedChildren ? specialist.assignedChildren.length : 0 %>
                                    </span></td>
                                <td>
                                    <div class="action-buttons">
                                        <a href="/admin/specialists/<%= specialist._id %>"
                                            class="btn btn-sm btn-outline" title="<%= __('view') %>">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <form action="/admin/specialists/<%= specialist._id %>/delete" method="POST"
                                            class="inline"
                                            onsubmit="return confirm(`<%= __('confirmDelete') || 'هل أنت متأكد من الحذف؟' %>`)">
                                            <button type="submit" class="btn btn-sm btn-danger"
                                                title="<%= __('delete') %>">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            <% }); %>
                                <% } else { %>
                                    <tr>
                                        <td colspan="8" class="text-center text-muted">
                                            <%= __('noData') %>
                                        </td>
                                    </tr>
                                    <% } %>
                </tbody>
            </table>
        </div>

        <%- include('../partials/bulk-actions', { entityType: 'specialists' }) %>
            <%- include('../partials/layout-end') %>